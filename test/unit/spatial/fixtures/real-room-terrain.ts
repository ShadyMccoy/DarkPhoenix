/**
 * @fileoverview Real room terrain data from game server.
 *
 * These fixtures contain actual terrain patterns from rooms
 * to test spatial algorithms with realistic data.
 *
 * Legend:
 * - '#' = wall (TERRAIN_MASK_WALL = 1)
 * - '~' = swamp (TERRAIN_MASK_SWAMP = 2)
 * - '.' = plain (0)
 */

import { TERRAIN_MASK_WALL, TERRAIN_MASK_SWAMP } from "../../mock";

/**
 * Creates a terrain callback from a 50-line string pattern.
 * '#' = wall, '~' = swamp, '.' = plain
 */
export function terrainFromPattern(pattern: string[]): (x: number, y: number) => number {
  return (x: number, y: number): number => {
    if (y < 0 || y >= pattern.length) return TERRAIN_MASK_WALL;
    if (x < 0 || x >= pattern[y].length) return TERRAIN_MASK_WALL;
    const char = pattern[y][x];
    switch (char) {
      case '#':
        return TERRAIN_MASK_WALL;
      case '~':
        return TERRAIN_MASK_SWAMP;
      default:
        return 0;
    }
  };
}

// ============================================================================
// E75N8 - Starting Room (the owned room)
// ============================================================================

export const E75N8_TERRAIN_PATTERN = [
  "##############.....###############################",
  "###...########......##############################",
  "##.....#######......##################....########",
  "##.....######......###########..#####......##...##",
  "##....######.......##########...~####............#",
  "##...#####..........########.....~###............#",
  "##...####..............~~~.........#.............#",
  "##....##..............~~~.......................##",
  "##........~~~.........~~~......................###",
  "#.........~~~..........~~.................########",
  "#.......###~~.....####.................###########",
  "#......#####.....######.............##############",
  "#......#####.....######............###########..##",
  "#.......###......#######..##.......##########....#",
  "........###.......###########.......#########.....",
  ".......####............#########.......#####......",
  "....########............##########.......##.......",
  "...#########............############..............",
  "...########......##....~#############.............",
  "....####........####...~##############............",
  "....###.........#####...##############......###...",
  "....##...........######...###########......#####..",
  "...###............#######..#########.......#####..",
  "..####..............#####..~#####.........#####...",
  "..###.................###................######...",
  "..###..................##...............######....",
  "..####...................##............######.....",
  "..#####...........###....###...........#####..~~..",
  "..#####..........#####...###...........#####..~~..",
  "...###............####...####...........###.......",
  "...................##....####.....................",
  "..........~~.##...........####...................",
  "..........~~#######........####...................",
  "..........~~########.........###.....~............",
  "..........~~########..........###...~~~...........",
  "........##...######............###.~~~............",
  ".......####...#####.....####~~.####.~..............",
  ".......#####.######....######~~#######............",
  ".......#############..#######~~########...........",
  ".......#####################~~~.#######...........",
  "#......#################...~~....######...........",
  "#.....#################..........######...........",
  "#.....############..##...........#####............",
  "##.....#...######...............#####.............",
  "##..~.......####................####.........##...",
  "##..~...........................####.......~####..",
  "##...............................##........#######",
  "###.......................................########",
  "######..##...........................#############",
  "###########........................###############",
];

export const E75N8_TERRAIN = terrainFromPattern(E75N8_TERRAIN_PATTERN);

// ============================================================================
// E74N8 - "Flooded" Room (west of starting room, has excessive territory issue)
// ============================================================================

export const E74N8_TERRAIN_PATTERN = [
  "###..........................................#####",
  "##............................................####",
  "#....~.....~.##...........######.......##......###",
  "#....##~..~~#######~~....########.....####..~~~.##",
  "#...####~~~~########~~~~.########.....####~~~~~~##",
  "##..#####~~#########~~~~~#########...#####~~~~~~##",
  "##..###############~~~~~..################~~~~~..#",
  "##...##############~~~......##############.......#",
  "##...~#############~~....~~~~############........#",
  "##....##############~~..~~~~~##########...~......#",
  "##....~##~~~############~~~~~#########~.~~~~....##",
  "###..~~~~~~~~############~~~~#########...~~~....##",
  "####~~~~~~~~~~############..##########..~.......##",
  "####~~~~.........######################..........#",
  "###~~~~~.........~######################~~..~~....",
  "##~~~~~~.........~#######################~~~~~~...",
  "#...~~~~..........~#######################~~~~....",
  "#....~~~...........~~~#######################.....",
  "#....~~~....~~~~....~~.########################...",
  "##....~~...~~~~~~...~~~##################~.#####..",
  "###....~....~~~~~~~~~~##################~...####..",
  "###............~~~~~~###################.....##...",
  "####..###.......~~~~####################..........",
  "#########.......~~~~############..######..........",
  "#########........~~~...~#######.....###...........",
  "####~~~.....~~....~......######........~~~........",
  "###.~~......~~~...........#####...................",
  "##..........~~.............####...................",
  "##.............##..........####...........~~......",
  "###............######~~.....##...........~~~~.....",
  "####...~~~~~~~~#######~~~~~~..........~~~~~~~~....",
  "#####.~~~~~~~~~~######~~~~~~~.........~~~~~~~~~...",
  "#####.~~~~~~~~~~#####~~..~~~~.........~~~~~~~~~...",
  "######.~~~~~~~~~~##.......~~~~.........~~~..~~~...",
  "######..~~~~##~~~~~~......~~~~~~~~..........~~~...",
  "#######....####~~~~~~.....~~~~~~~~.........~~~~...",
  "########...#####~~~~~....~~~~~~~..........~~~~~...",
  "########..~######.~~.....~~~~~..##........~~~~~...",
  "#######...~~#########....~~~~...###.......~~~~~...",
  "######....~~##########....~~....####......##~~~...",
  "#####.~~...~##########..........####~~~..#####...#",
  "#####~~~...##########..........#####~~~.#######..#",
  "#####~~~...##########~.......#######....##########",
  "####~~~~..##########........#########..###########",
  "##..~~~..########..........~######################",
  "#...~~..########...........#######################",
  "#.....#########~.....~############################",
  "##..##########~~.....#############################",
  "###############~##################################",
  "##################################################",
];

export const E74N8_TERRAIN = terrainFromPattern(E74N8_TERRAIN_PATTERN);

// ============================================================================
// Helper function to count walkable tiles in a room terrain
// ============================================================================

export function countWalkableTiles(terrain: (x: number, y: number) => number): number {
  let count = 0;
  for (let x = 0; x < 50; x++) {
    for (let y = 0; y < 50; y++) {
      if (terrain(x, y) !== TERRAIN_MASK_WALL) {
        count++;
      }
    }
  }
  return count;
}

// ============================================================================
// Terrain statistics for verification
// ============================================================================

export const TERRAIN_STATS = {
  E75N8: {
    expectedWalkableTiles: 1550, // Approximate, adjust after verification
  },
  E74N8: {
    expectedWalkableTiles: 1300, // Approximate, adjust after verification
  },
};
